# Hnefatafl Backend - Project Information for Claude

## Project Overview
This is a Haskell backend for a Hnefatafl (Viking board game) application using modern Haskell practices.

## Key Technologies
- **Language**: Haskell with GHC2021 standard
- **Effect System**: Effectful library for effect management
- **Web Framework**: Servant + servant-server + servant-effectful
- **Database**: SQLite with sqlite-simple
- **Build System**: hpack (package.yaml) + Cabal
- **Development Environment**: Nix flake

## Project Structure
- `src/Hnefatafl/` - Main library code with effect-based architecture
- `cli/` - Command line interface executable
- `test/` - Test suite using Tasty framework
- `db/` - Database schema and migrations
- `libhnefatafl.a` - Linked C library for game engine

## Build Commands
- **Generate .cabal**: `hpack` (regenerates hnefatafl.cabal from package.yaml)
- **Build**: `cabal build`
- **Test**: `cabal test`
- **Run CLI**: `cabal run cli`
- **Clean**: `cabal clean`

## Development Workflow for Claude
- **Always verify compilation**: After any code changes, run `cabal build` to ensure code compiles
- **Test verification**: When creating new tests, run `cabal test` to verify they pass
- **Regenerate .cabal**: Run `hpack` if package.yaml is modified

## Code Style
- Uses GHC2021 language standard
- Default extensions include OverloadedStrings, TemplateHaskell, LambdaCase, OverloadedRecordDot
- **Record access**: Uses OverloadedRecordDot syntax (e.g., `record.field` instead of traditional field accessors)
- **IMPORTANT**: To use dot notation on any record type, you MUST import the type with field constructors using `(..)` syntax
  - Example: `import Module (SomeRecord (..), ...)`
  - Without `(..)`, record fields are not accessible and `record.field` will fail to compile
- Uses Relude as custom Prelude
- Strict GHC warnings enabled (unused imports, missing exports, etc.)
- Uses optics for lens-like operations

## Key Dependencies
- **effectful**: Main effect system
- **servant**: Web API framework
- **sqlite-simple**: Database interface
- **relude**: Alternative prelude
- **optics**: Lens library
- **chronos**: Time handling
- **uuid-types**: UUID support

## Testing
- Uses Tasty test framework with tasty-hspec and tasty-hunit
- Test discovery with tasty-discover
- Tests located in `test/` directory

## Development Notes
- **Primary config**: `package.yaml` (hpack format)
- **Generated file**: `hnefatafl.cabal` (auto-generated, don't edit directly)
- Uses custom effect system with interpreters in `src/Hnefatafl/Interpreter/`
- Effects defined in `src/Hnefatafl/Effect/`
- Links against external C library (`libhnefatafl.a`)
- Database schema in `db/schema.sql`
- Current branch: `rest-app`, main branch: `master`

## Important Files
- `package.yaml` - **Main project configuration** (edit this, not .cabal)
- `hnefatafl.cabal` - Generated by hpack (don't edit directly)
- `cabal.project` - Cabal project settings
- `flake.nix` - Nix development environment
- `fourmolu.yaml` - Code formatter configuration

## Implementation Guidelines
- **NEVER change the user's designed approach without explicitly asking first**
- When implementing technical solutions, follow the user's specified approach exactly
- If there are issues, fix the implementation details rather than changing the approach